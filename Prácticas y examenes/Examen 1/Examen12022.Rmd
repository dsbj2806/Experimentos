---
title: "Solución: Examen 1 2022"
author: "Daniel Sibaja Salazar"
output:
  html_document:
    css: "tema1.css"
---

# Pregunta 1

## 1.A

La variable respuesta es la diferencia entre las mediciones de la frecuencia cardiaca, esta variable respuesta es conveniente porque de esa forma podemos observar cuanto cambiaron estas y no una medición de después de después de hacer ejercicios en la que en realidad no tenemos forma de saber si una persona tiene estas variables así por los ejercicios o porque ya es así por otra razón. 

## 1.B 

El error tipo II se comete cuando la hipótesis no se rechaza siendo falsa. En el contexto de un experimento de un factor, esto significaría asumir que ningún ejercicio produce una mayor o menos afectación en la frecuencia cardíaca. Es fácil imaginar el problema que podría significar, si por ejemplo, a la hora de recomendarle un ejercicio a una persona con problemas del corazón en realidad le recomendamos uno que aumenta más su frecuencia de lo que debe, existiendo otras alternativas. 

## 1.C

Se fija el hecho de que son personas de un equipo de balonmano, lo cual implica que son personas que hacen ejercicio, probablemente de edades similares o iguales y que todos son del mismo género.
Esto ayuda controlar alguna de que estas variables metan ruido a la variabilidad de la variable respuesta. 

## 1.D 

Con el modelo de suma nula, el vector sería:

c(1,-1,-1,-1)

## 1.E

Como se hizo con el tratamiento de referencia entonces debo de tomar el vector de sentadillas 

c(1,0,0,1)

y multiplicarlo por el vector de coeficientes 

el experimento es balanceado entonces puedo sacar el promedio general, promediando los promedios por tratamiento

```{r}
vc=c(1,0,0,0)
vj=c(1,1,0,0)
vsc=c(1,0,1,0)
vs=c(1,0,0,1)
coef=c(42.6,-8.4,-4.4,-9.0)


mean(c(vc%*%coef,vj%*%coef,vsc%*%coef,vs%*%coef)) ## Ni idea de como calcular el promedio general, en la solución del examen dice que es 37.15

vs%*%coef-37.15

promedios=c(vc%*%coef,vj%*%coef,vsc%*%coef,vs%*%coef);names(promedios)=c("Correr","JumpingJacks","Salto","Sentadillas");promedios
```
El efecto es -3.55, quiere decir que el promedio del tratamiento es 3.55 unidades menor que el promedio general.

## 1.F

Las hipótesis son las siguientes:

- $H0: \frac {\mu2+\mu4}{2}=\frac {\mu1+\mu3}{2}$
- $H0: \mu2=\mu4$
- $H0: \mu1=\mu3$

Los vectores para determinar ortogonalidad son los siguientes.

- (1/2,-1/2,1/2,-1/2)
- (0,1,0,-1)
- (1,0,-1,0)

```{r}
v1=c(1/2,-1/2,1/2,-1/2)
v2=c(0,1,0,-1)
v3=c(1,0,-1,0)

crossprod(v1,v2)
crossprod(v1,v3)
crossprod(v2,v3)
```

Si hay ortogonalidad, lo cual indica que no hay que hay que hacer corrección de Bonferroni. 



# Pregunta 2

Se realizó un experimento desbalanceado con tres tratamientos. Se tiene el promedio y la varianza de la variable respuesta en cada uno de los tratamientos, así como el número de réplicas: 

```{r}
trat=c("T1","T2","T3")
r=c(7,5,5)
promedio=c(3.26,2.86,1.30)
varianza=c(0.541,0.079,1.001)
```

## CMTrat

```{r}
yb=sum(promedio*r)/sum(r);yb
yby=(promedio-yb)^2;yby
sctrat=sum(r*yby);sctrat
cmtrat=sctrat/2;cmtrat
```


## CMRes

```{r}
rm1=r-1;rm1
rpv=rm1*varianza;rpv
scres=sum(rpv);scres
n=sum(r);n
cmres=scres/(n-3);cmres
```


## ¿Qué se está estimando?

Es una estimación de la variabilidad dentro de los tratamientos.


# Pregunta 3 

Se sabe que la fresa es una fruta muy sensible para perecer en un periodo corto de tiempo. Por esta razón en un estudio se propone analizar cuál de los 4 tipos de enjuagues (agua con bicarbonato, agua con sal, agua con limón y agua con vinagre) maximiza la vida útil de las fresas refrigeradas en el hogar.
Se observan las fresas dentro de cada bandeja donde se han colocado una cierta cantidad de fresas. Se mide la vida útil como la cantidad de días en los que las fresas no presentan defectos físicos notables hasta que se descarta la última fresa. Se toma el tiempo promedio de vida de las fresas de una misma bandeja.
Todos los tratamientos se corren en un mismo refrigerador, con lo cual se necesitan 4 bandejas en un mismo refrigerador. Se usan en total 5 refrigeradores y en cada uno se lleva a cabo el mismo experimento, pero se colocan las bandejas en diferentes posiciones dentro de cada refrigerador.
Se realizó un análisis de varianza y se determinó que el tipo de enjuague tiene un efecto sobre el promedio de la vida útil promedio de las fresas. Se hicieron comparaciones múltiples de todos los pares y se determinó que hay diferencia en los siguientes pares de tratamientos “agua con vinagre” vs “agua con bicarbonato” y “agua con vinagre” vs “agua con sal”. Los investigadores plantearon como diferencia relevante en la diferencia de la frecuencia un valor de 1 día. 
Con los siguientes datos, y el programa R, calcule los intervalos de confianza para los dos pares de promedios en los que se encontraron diferencias. Interprete los resultados.

```{r}
y=c(6.7,6,6.5,4.9,6,6.1,6.8,6.3,6.4,6.1,6.4,6.4,6,5.3,6.1,7.3,7.1,7.2,6.8,7.3)
trat=c(rep("Bicarbonato",5),rep("Limón",5),rep("Sal",5),rep("Vinagre",5))

base=data.frame(y,trat)
base$trat=factor(base$trat)

```

Puedo Hacer el modelo
```{r}
options(contrasts=c("contr.sum","contr.poly"))
mod=aov(base$y~base$trat)

coef=mod$coefficients
```

También puedo calcular los promedios por tratamiento

```{r}
m=tapply(base$y,base$trat,mean);m
```



Primero hay que plantear las hipótesis, al menos las que dieron significativas

Asumo que:

mu1=Bicarbonato
mu2=Limón
mu3=Sal
mu4=Vinagre

Bicarbonato vs vinagre

$$
H0: \mu_4=\mu_1
$$

$$
H1: \mu_4<>\mu_1
$$

Y la otra: Vinagre vs sal

$$
H0: \mu_4=\mu_3
$$

$$
H1: \mu_4<>\mu_3
$$

El siguiente paso es hacer los L1 y L2

$$
H0: \mu_4-\mu_1=0
$$
$$
H0: \mu_4-\mu_3=0
$$

Los vectores en este caso entonces serían 

(-1,0,0,1) y (0,0,-1,1)

En este caso no se debe de comprobar ortogonalidad porque se hicieron comparaciones múltiples, se compararon todos los pares con tosos por lo tanto no es necesario hacerlo, siempre hay que hacer la corrección de bonferroni

En este caso puedo hacer las comparaciones con el vector de promedios 

Puedo calcular los L techo.
```{r}
v1=c(-1,0,0,1)
v2=c(0,0,-1,1)

lt1=m%*%v1;lt1
lt2=m%*%v2;lt2


```

Ahora debo calcuiar el cmres, con el objetivo de posteriormente calcular el error estándar 

```{r}
summary(mod)
cmres=0.204

sum1=sum(v1^2)/5;sum1
sum2=sum(v2^2)/5;sum2

ee1=sqrt(cmres*sum1)
ee2=sqrt(cmres*sum2)
```

También necesito el cuantil t sin olvidar la corrección de bonferroni


```{r}
tq=qt(1-0.05/(2*2),16)
```

Y finalmente los intervalos

```{r}
c(lt1-tq*ee1,lt1+tq*ee1)
c(lt2-tq*ee2,lt2+tq*ee2)
```

Los intervalos me indican que con un 95% de confianza global se espera que la diferencias estén entre 0.6212759  y 0.6012759  y 1.6187241 y 1.5987241 respecticamente. Siendo que la diferencia relevante es de 1, y que la cota inferior del intervalo es menor que 1 por lo que es posible que la diferencia sea menor a la relevante. 

También puedo hacerlo con suma nula.

Recordando que suma nula tiene una restricción de t4=-(t1+t2+t3)

```{r}
contrasts(base$trat)
coef=mod$coefficients
```

Recordando los vectores

(-1,0,0,1) y (0,0,-1,1)

entonces debo remplazarlos por los efectos 

(hecho a mano)

(1,-2,-1,-1) y (1,-1,-1,-2)

```{r}
h1=c(0,-2,-1,-1)
h2=c(0,-1,-1,-2)

lk1=h1%*%coef;lk1
lk2=h2%*%coef;lk2

```

Ahora calculo el error estándar

```{r}
ee1k=sqrt(diag(t(h1)%*%vcov(mod)%*%h1));ee1k
ee2k=sqrt(diag(t(h2)%*%vcov(mod)%*%h2));ee2k

```

El cuantil t 

```{r}
tk=qt(1-0.05/(2*2),16);tk
```

Y ahora los intervalos

```{r}
c(lk1-tk*ee1k,lk1+tk*ee1k)
c(lk2-tk*ee2k,lk2+tk*ee2k)

```

La interpretación es la misma que la que hicimos anteriormente.



---
title: "Practica 1 Experimentos"
author: "Daniel Sibaja Salazar"
date: "2024-04-30"
output: html_document
---
En un estudio para evaluar 3 métodos de enseñanza de lectura, dos investigadoras tomaron 66 niños y asignaron cada uno de forma aleatoria a un grupo. En cada grupo se aplicó un método diferente de enseñanza, los cuales eran: el método estándar (Basal) y dos métodos nuevos (DRTA y Strat). Se realizaron tres pruebas llamadas (test1, test2, test3) a todos los niños para medir diferentes aspectos de comprensión de lectura.

Los datos están en el archivo "lectura.Rdata". Puede leerlo en R usando load("lectura.Rdata") y se encuentran en un objeto llamado base.

# Preparación

```{r}
load("lectura.Rdata")
str(base)
options(scipen=999)
```

# Obtenga un gráfico de los valores de los puntajes del test1 por cada tratamiento.

```{r}
boxplot(base$test1~base$grupo)
```

## ¿Qué espera encontrar referente a los promedios de puntaje en este caso?

Se espera encontrar que el promedio de DRTA sea el mayor, y el de Strat el menor, sin embargo, la variabilidad de este último es muy alta. 

# Usando la terminología de diseño de experimentos, especifique cada uno de los siguientes conceptos:

- Variable respuesta: Son los puntajes en cada test
- Factor de diseño: El método de enseñanza
- Niveles: Basal, DRTA, Strat
- Tratamientos: Igual que los niveles
- Número de repeticiones: 22 en cada grupo
- ¿Error tipo I?: Sería asumir que todos los metodos producen los mismos resultados, es potencialmente peligroso si se decide enseñar un método que en realidad es peor a lo que se  cree. 
- ¿Error tipo II?: Asumir que hay al menos un par de métodos distintos cuando no lo hay, puede ser peligroso si se asume que un método es mejor, pero por ejemplo más complicado de enseñar, cuando en realidad otro más sencillo es igual de eficiente. 
- Solo se pueden hacer generalizaciones, dentro del grupo de edad de los niños, su nivel de escolaridad, o incluso su nivel de lectura. 
- Se puede fijar el estudio a solo personas de cuarto grado de la escuela, por ejemplo. El objetivo es entonces poder eliminar alguna variabilidad que venga de la edad de las personas en el estudio. 
- Horas de lectura de las personas no es controlable pero si es medible.
- Cuantas horas de lectura tienen a la semana los niños, puede ser que haya niños más avanzados que otros. 

# Obtenga la media, desviación estándar y varianza de los puntajes del test3 para cada método. Obtenga la media general. Haga un gráfico donde se representen las medias de cada especie y la media general.Coloque luego los puntos

```{r}
mt3=tapply(base$test3,base$grupo,mean);mt3
vt3=tapply(base$test3,base$grupo,var);vt3
sdt3=tapply(base$test3,base$grupo,sd);sdt3
mgt3=mean(base$test3);mgt3

plot(as.numeric(base$grupo),base$test3);abline(h=mgt3,col="Orange");points(mt3,col="Orange",pch="*",cex=2)
```

# Siga usando los puntajes del Test 3

## ¿Cuál es el efecto de cada método?

```{r}
efectos=mt3-mgt3;round(efectos,2)
```
## Cuando se habla del efecto, ¿a qué se refiere exactamente?

Cuanto aumenta o disminuye el promedio de un tratamiento o nivel de un factor con respecto a la media general. 

## Calcule el residual para el primer individuo que usó el método estándar

```{r}
base$test3[1]-mt3[1]
```

## Obtenga todos los residuales manualmente y también de forma automática en R

```{r}
base[base$grupo=="Basal",]$test3-mt3[1]
base[base$grupo=="DRTA",]$test3-mt3[2]
base[base$grupo=="Strat",]$test3-mt3[3]



mod=lm(test3~grupo,data=base)
mod$residuals
```


## ¿Cuánto deberían sumar los residuales dentro de cada tratamiento? Verifíquelo

Debería de sumar 0

```{r}
round(sum(base[base$grupo=="Basal",]$test3-mt3[1]),1)
```

## Dé una estimación de la variabilidad del error para el método estándar.

```{r}
var(base[base$grupo=="Basal",]$test3-mt3[1])
```
# Se quiere probar la hipótesis de que los promedios de los puntajes del test3 son iguales para los tres métodos. Esta pregunta es sólo para el test3.

## Escriba la hipótesis a probar en forma simbólica

$$
H0: \mu1=\mu2=\mu3
$$

## Plantee la hipótesis desde el enfoque de los efectos con palabras y con símbolos

$$
H0: \tau_1=\tau_2=\tau_3=0
$$

Los tres tratamientos producen las mismas medias, quiere decir que los tres efectos son nulos. 

## Si se concluye que algún promedio es más alto que los otros, ¿se puede atribuir esa diferencia al método como causa? ¿Entonces es correcto hablar de efecto del método en este caso?

Si se puede decir que hay causalidad debido a la aleatoriedad, pero hay que tener cuidado en el sentido de que pueden haber factores confundidos que afecten el resultado. 

## ¿Cuántos grados de libertad deben usarse para el cálculo de la variabilidad entre los 3 promedios?

2

## Calcule manualmente la estimación para la varianza entre los 3 promedios. No tiene que hacer absolutamente todos los cálculos, puede usar resultados intermedios. ¿Cómo se llama usualmente este resultado?

```{r}
sctrat=sum(22*(mt3-mgt3)^2);sctrat
cmtrat=sctrat/(3-1);cmtrat
```

Es el cuadrado medio de tratamientos. 

## ¿Cuántos grados de libertad deben usarse para el cálculo de la varianza dentro de tratamientos?

n-k=66-3=63

## ¿Cuántas estimaciones de la variancia dentro de tratamientos se pueden obtener? ¿Cuál es la más adecuada? ¿Cuál está más cerca de la verdadera variancia?

Se pueden obtener las 3 varianzas individuales y el cuadrado medio residual. 

Es mejor el cmres

## Calcule la variancia ponderada dentro de tratamientos. ¿Cómo se llama usualmente este resultado?

```{r}
scres=sum((22-1)*vt3)
cmres=scres/63;cmres
mean(vt3)
```
## Si se aumentara el número de personas en cada método, ¿se podría esperar que la variancia dentro de tratamientos disminuya?

No necesariamente, en realidad cualquier cosa puede ocurrir, sin embargo lo que si podría ocurrir es que se acerque a la varianza verdadera

## Justifique por qué se pueden promediar o ponderar las varianzas.

Porque se asume homocedasticidad 

## Justifique por qué al ponderar las varianzas se usan los grados de libertad para hacer la ponderación. 


## ¿Cuál es la probabilidad de cometer error tipo I? Interprete esta probabilidad

## ¿Cuál es la conclusión en términos de la hipótesis que se quería probar? Use para dar su conclusión primero los valores de las variancias entre promedios y de error, y también use la probabilidad de error tipo I

```{r}
f=cmtrat/cmres;f
pf(f,2,63,lower.tail = F)

anova(mod)
```

La varianza entre los tratamientos es 4 veces mayor que la varianza dentro de los tratamientos, lo cual no apoya la hipótesis de que deben de ser iguales.

Con una probabilidad de  0.01 se rechaza la hipótesis nula de igualdad. 

## ¿En qué punto de este análisis se usó el supuesto de varianzas iguales?

A la hora de calcular el cuadrado medio residual. 

# Obtenga la varianza total de la respuesta y deduzca a partir de ahí la suma de cuadrados total. Compare el resultado con el de la tabla del ANOVA. Compruebe la aditividad de las sumas de cuadrados de las dos fuentes de variación en la tabla de ANOVA. Comente por qué no existe aditividad en los cuadrados medios. Esta pregunta es sólo para el test3

```{r}
sum((base$test3-mgt3)^2)

anova(mod)

round(357.3+2511.7,2)
```

No existe aditividad en los cuadrados medios porque para obtenerlos hay que dividirlos entre un número que no es igual. 

# Las investigadoras están interesadas en estudiar dos cosas: 1) si los nuevos métodos producen resultados similares al método estándar, y 2) si los dos nuevos métodos difieren en su efectividad. Esta pregunta involucra los tres tests.

## Plantee las hipótesis asociadas a las dos preguntas que tienen las investigadoras. Escriba los contrastes asociados a esas hipótesis.


Tomando en cuenta que 

mu1= mu basal
mu2= mu DRTA
mu3= Strat

$$
H0: \mu1=\frac{\mu2+\mu3}{2}
$$

$$
H0: \mu2=\mu3
$$

$$ 
H1: \mu1<>\frac{\mu2+\mu3}{2}

$$

$$
H1: \mu2<>\mu3
$$

Podemos hacer el anova primero a ver si vale la pena

```{r}
mod1=aov(test1~grupo,data=base)
mod2=aov(test2~grupo,data=base)
mod3=aov(test3~grupo,data=base)

mt3
```

Si se detectan diferencias

### Contrastes

Puedo hacerlo con los promedios 

c(-1,0.5,0.5)
c(0,1,-1)

```{r}
mt1=tapply(base$test1,base$grupo,mean)
mt2=tapply(base$test2,base$grupo,mean)
mt3=tapply(base$test3,base$grupo,mean)

v1=c(-1,0.5,0.5)
v2=c(0,1,-1)

crossprod(v1,v2) ## Hay ortogonalidad
```
Ahora puedo pasarlo a suma nula 
Recordad que entonces $\mu3=-(\mu1+\mu2)$

```{r}
h1=c(0,-3/2,0)
h2=c(0,1,2)
```


Test 1
```{r}
c1=mod1$coefficients
lt11=crossprod(c1,h1);lt11
lt12=crossprod(c1,h2);lt12
```

Test 2
```{r}
c2=mod2$coefficients

lt21=crossprod(c2,h1);lt21
lt22=crossprod(c2,-h2);lt22
```

Test 3
```{r}
c3=mod3$coefficients

lt31=crossprod(c3,h1);lt31
lt32=crossprod(c3,h2);lt32

lt=c(lt11,lt12,lt21,lt22,lt31,lt32);lt
```

Ahora calculo la probabilidad asociada 

primero los errores estándar 
```{r}
ee11=sqrt(t(h1)%*%vcov(mod1)%*%h1)
ee12=sqrt(t(h2)%*%vcov(mod1)%*%h2)
ee21=sqrt(t(h1)%*%vcov(mod2)%*%h1)
ee22=sqrt(t(h2)%*%vcov(mod2)%*%h2)
ee31=sqrt(t(h1)%*%vcov(mod3)%*%h1)
ee32=sqrt(t(h2)%*%vcov(mod3)%*%h2)

ees=c(ee11,ee12,ee21,ee22,ee31,ee32);ees
```

Y ahora los valores estandarizados y las probabilidades

```{r}
estand=lt/ees;estand

round(pt(estand,63,lower.tail = F),3)<0.025
```

Solo se aceptan una hipótesis, la segunda del test 3

Hay que hacer intervalos de confianza para todas las demás 


```{r}
tt=qt(1-0.025,63);tt

round(cbind(lt[-6]-tt*ees[-6],lt[-6]+tt*ees[-6]),2)
```

Ninguna diferencia es lo suficientemente alta como para ser relevante. 

Las primeras dos corresponen al test 1, la 3 y 4 al test 2 y la última al test 3 especificamente la primera hipótesis. 


# ¿Tendría sentido realizar el punto anterior si en el ANOVA no se rechaza la hipótesis nula con alguno de los tests?¿Qué pregunta cabría hacerse en ese caso?

No tiene sentido, pero vale la pena preguntarse si la potencia fue suficiente. 

# Suponga ahora que las investigadoras simplemente quieren ver cuál método es mejor, cuál segundo y cuál tercero. Haga las comparaciones adecuadas

```{r}
TukeyHSD(mod1)
TukeyHSD(mod2)
TukeyHSD(mod3)

```
En el primer método solo se rechaza la hipótesis DRTA-Basal
En el segundo método solo se rechazan las hipótesis Strat-Basal
En el tercer método solo se rechaza la hipótesis DRTA-Basal


Se hacen los contrastes 


```{r}

c1=c(0,1,-1)
c2=c(0,-2,-1)

co1=mod1$coefficients
co2=mod2$coefficients
co3=mod3$coefficients


cc1=c1%*%co1;cc1
cc2=c2%*%co2;cc2
cc3=c1%*%co3;cc3

## Los errores estándar 

ee1=sqrt(t(c1)%*%vcov(mod1)%*%c1)
ee2=sqrt(t(c2)%*%vcov(mod2)%*%c2)
ee3=sqrt(t(c1)%*%vcov(mod3)%*%c1)

## Los intervalos 

cc1+tt*ee1;cc1-tt*ee1
cc2-tt*ee2;cc2+tt*ee2
cc3+tt*ee3;cc3-tt*ee3

```


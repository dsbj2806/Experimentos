---
title: "Laboratorio Manzanas"
author: "Daniel Sibaja Salazar"
date: "2024-04-02"
output:
  html_document:
    toc: true
    toc_float: true
    css: tema1.css
  pdf_document:
    toc: true
---

# Preparación

```{r}
base=read.csv("manzanas.csv",sep= ";") # Se lee el archivo
base$trat=factor(base$trat) # Se pone el factor
levels(base$trat)= c("control","tapar","bolsa","limón")
#save(base,file="manzanas.Rdata") #Se guarda el archivo
```

# Análisis gráfico

```{r}

m=tapply(base$color,base$trat,mean);m #Media ppor trat
v=tapply(base$color,base$trat,var);v #Var por trat
media=mean(base$color);media # Media general

boxplot(base$color~base$trat);abline(h=media,col=2);points(1:4,m,col=4,pch="-",cex=2) # Gráfico

taus=m-media;taus# Efectos por tratamiento

st=sum(taus);st # Suma de los efectos
ve=mean(v);ve # Varianza del error
```

Los efectos significan que:

-   El control aumenta el promedio general en 2.1
-   Taparlos los disminuye en -0.1
-   La bolsa lo disminuye en -0.5
-   El limón lo disminuye en -1.5

# Análisis de varianza

```{r}
mod=lm(color~trat,data = base)
mod1=aov(color~trat,data = base)

mod;mod1;aov(mod) # Ajustar el modelo con diferentes fórmulas

anova(mod);anova(mod1) # Análisis de varianza

cmres=anova(mod)[2,3] # Cuadrado medio residual
cmres;ve  # Son iguales

df=anova(mod)[2,1];df 
```

Son 36 grados de libertad residuales porque se definen como n-k

```{r}
sctrat=anova(mod)[1,2];sctrat #Suma de cuadrados del tratamiento

10*sum(taus**2) # Es igual a la suma de cuadrados de tratamiento
```

Se consideran solo 4 diferencias, no los 40 datos que hay, por esta razón hay que multiplicarlo por el número de réplicas que hay. Hay que darle un peso a esa diferencia.

```{r}
anova(mod)[1,3];anova(mod)[2,3]

(f=anova(mod)[1,3]/anova(mod)[2,3])

(p=pf(f,3,36,lower.tail = F))
```

Ya que el F está lejano al 1 esperable y la probabilidad asociada es prácticamente 0 hay sospechas de que si hay tratamientos que producen efectos diferentes de 0.

$$H0: \mu_1=\mu_2=\mu_3=\mu_4$$

H1: Al menos un par de promedios es distinto

Hay suficiente evidencia estadística para rechazar la hipótesis nula de que los promedios por tratamiento son todos iguales.

# Estimación de parámetros con el modelo de tratamiento de referencia.

```{r}
coef=mod$coefficients;coef
```

b.  El intercepto es la media del tratamiento que escogimos como referencia.

c. Los otros coeficientes representan la distancia que hay de la media de cada uno de los otros tratamientos con respecto a la media del control. **PREGUNTAR**

```{r}
model.matrix(mod)
```
## Efectos muestrales

```{r}
coef

t1=c(1,0,0,0)
t2=c(1,1,0,0)
t3=c(1,0,1,0)
t4=c(1,0,0,1)

mc=c(coef%*%t1,coef%*%t2,coef%*%t3,coef%*%t4);mc
mc-media;taus
```
## Efectos automáticamente

```{r}
model.tables(mod1)
```

# Modelo de suma Nula 

```{r}
options(contrasts=c("contr.sum","contr.poly"))# Cambiar a suma nula

# options(contrasts=c("contr.treatment","contr.poly")) # Cambiar a referencia 


contrasts(base$trat)
```

## Repetir el punto 4.

```{r}
mod2=lm(color~trat,data = base)
mod2aov=aov(color~trat,data = base)

coef2=mod2$coefficients;coef2


```

En este caso el intercepto es la general y los demás coeficientes son los efectos por tratamiento sin tomar en cuenta el último


```{r}
model.matrix(mod2)
```

```{r}
coef2

v1=c(1,1,0,0)
v2=c(1,0,1,0)
v3=c(1,0,0,1)
v4=c(1,-1,-1,-1)

mc2=c(coef2%*%v1,coef2%*%v2,coef2%*%v3,coef2%*%v4)

mc2-media

```

```{r}
model.tables(mod2aov)
```

# Factor con dos niveles

```{r}
base1=rbind(base[base$trat=="control",],base[base$trat=="tapar",])

base1$trat=factor(as.numeric(base1$trat))

mod3=lm(color~trat,data = base1)

anova(mod3) # Se rechaza la hipótesis nula de igualdad de medias

summary(mod3) # Se rechaza la hipótesis nula t de igualdad de medias


```

Ambos resultados son iguales, en ambos casos se rechaza la hipótesis nula


## Hecho a mano. 

```{r}
t1t=1.1
eet=0.2357

t=t1t/eet;t

gl=20-2

(1-pt(t,gl))*2 # Se multiplica por dos porque es de dos colas

pt(t,gl,lower.tail = F)*2 ## Otra forma de hacerlo
```

